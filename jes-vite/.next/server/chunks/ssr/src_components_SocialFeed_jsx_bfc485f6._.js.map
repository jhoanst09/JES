{"version":3,"sources":["../../../../src/components/SocialFeed.jsx","../../../../src/services/cloudinary.js"],"sourcesContent":["'use client';\r\nimport { useRef, useEffect, memo, useCallback, useState } from 'react';\r\nimport { supabase } from '../services/supabase';\r\nimport { uploadToCloudinary } from '../services/cloudinary';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { useWishlist } from '../context/WishlistContext';\r\nimport Link from 'next/link';\r\nimport Image from 'next/image';\r\n\r\n// Memoized Post Component for performance\r\nconst PostCard = memo(function PostCard({\r\n    post,\r\n    toggleLike,\r\n    commentingOn,\r\n    setCommentingOn,\r\n    commentInput,\r\n    setCommentInput,\r\n    handleComment,\r\n    postComments = [],\r\n    isLoadingComments = false,\r\n    fetchComments\r\n}) {\r\n    useEffect(() => {\r\n        if (commentingOn === post.id && postComments.length === 0 && !isLoadingComments) {\r\n            fetchComments(post.id);\r\n        }\r\n    }, [commentingOn, post.id, postComments.length, isLoadingComments, fetchComments]);\r\n    return (\r\n        <div className=\"bg-white dark:bg-zinc-900 border border-black/10 dark:border-white/10 rounded-[40px] overflow-hidden shadow-xl transition-transform duration-300\">\r\n            <div className=\"p-6\">\r\n                <div className=\"flex justify-between items-start mb-4\">\r\n                    <Link href={post.userId ? `/wishlist?user=${post.userId}` : '#'} className=\"flex gap-4 group/avatar\">\r\n                        <div className=\"w-12 h-12 rounded-full overflow-hidden border-2 border-transparent group-hover/avatar:border-blue-500 transition-all relative bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center text-xl\">\r\n                            {post.avatar ? (\r\n                                <Image\r\n                                    src={post.avatar}\r\n                                    fill\r\n                                    sizes=\"48px\"\r\n                                    className=\"object-cover\"\r\n                                    alt=\"\"\r\n                                />\r\n                            ) : (\r\n                                'üë§'\r\n                            )}\r\n                        </div>\r\n                        <div>\r\n                            <h4 className=\"font-black text-zinc-900 dark:text-white lowercase group-hover/avatar:text-blue-500 transition-colors\">@{post.user}</h4>\r\n                            <p className=\"text-[10px] text-zinc-500 font-bold uppercase tracking-widest\">{post.time}</p>\r\n                        </div>\r\n                    </Link>\r\n                    <button className=\"text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-colors\">‚Ä¢‚Ä¢‚Ä¢</button>\r\n                </div>\r\n\r\n                <p className=\"text-zinc-800 dark:text-zinc-200 text-lg mb-4 leading-relaxed font-medium\">\r\n                    {post.content}\r\n                </p>\r\n\r\n                {post.image && (\r\n                    <div className=\"rounded-[32px] overflow-hidden mb-4 border border-black/5 dark:border-white/5 relative aspect-video\">\r\n                        <Image\r\n                            src={post.image}\r\n                            fill\r\n                            sizes=\"(max-width: 768px) 100vw, 640px\"\r\n                            className=\"object-cover\"\r\n                            alt=\"\"\r\n                        />\r\n                    </div>\r\n                )}\r\n\r\n                <div className=\"flex gap-8 border-t border-black/5 dark:border-white/5 pt-4\">\r\n                    <button\r\n                        onClick={() => toggleLike(post.id)}\r\n                        className={`flex items-center gap-2 transition-all active:scale-125 ${post.isLiked ? 'text-red-500' : 'text-zinc-600 dark:text-zinc-500 hover:text-red-500'}`}\r\n                    >\r\n                        {post.isLiked ? (\r\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"22\" height=\"22\" viewBox=\"0 0 24 24\" fill=\"currentColor\" className=\"text-red-500\"><path d=\"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z\" /></svg>\r\n                        ) : (\r\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"22\" height=\"22\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><path d=\"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z\" /></svg>\r\n                        )}\r\n                        <span className=\"text-xs font-black text-zinc-700 dark:text-zinc-300\">{post.likes}</span>\r\n                    </button>\r\n                    <button\r\n                        onClick={() => setCommentingOn(commentingOn === post.id ? null : post.id)}\r\n                        className=\"flex items-center gap-2 text-zinc-600 dark:text-zinc-500 hover:text-blue-500 transition-all\"\r\n                    >\r\n                        <span className=\"text-xl\">üí¨</span>\r\n                        <span className=\"text-xs font-black text-zinc-700 dark:text-zinc-300\">{post.comments}</span>\r\n                    </button>\r\n                    <button className=\"flex items-center gap-2 text-zinc-500 hover:text-green-500 transition-colors ml-auto\">\r\n                        <span className=\"text-xl\">üîó</span>\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Comments Section - CSS-based animation for performance */}\r\n                <div className={`overflow-hidden transition-all duration-300 ease-out border-t border-black/5 dark:border-white/5 mt-4 ${commentingOn === post.id ? 'max-h-[500px] opacity-100' : 'max-h-0 opacity-0 border-t-0'\r\n                    }`}>\r\n                    <div className=\"py-4 space-y-4\">\r\n                        {isLoadingComments ? (\r\n                            <p className=\"text-center text-[10px] text-zinc-500 font-bold uppercase tracking-widest animate-pulse\">Cargando comentarios...</p>\r\n                        ) : postComments.length > 0 ? (\r\n                            postComments.map(comment => (\r\n                                <div key={comment.id} className=\"flex gap-3\">\r\n                                    <div className=\"w-8 h-8 rounded-full overflow-hidden shrink-0 relative\">\r\n                                        <Image\r\n                                            src={comment.profiles?.avatar_url || 'https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?auto=format&fit=crop&q=80&w=150'}\r\n                                            fill\r\n                                            sizes=\"32px\"\r\n                                            className=\"object-cover\"\r\n                                            alt=\"\"\r\n                                        />\r\n                                    </div>\r\n                                    <div className=\"flex-1 bg-zinc-50 dark:bg-zinc-800/50 p-3 rounded-2xl border border-black/5 dark:border-white/5\">\r\n                                        <p className=\"text-[10px] font-black text-zinc-900 dark:text-white capitalize mb-1\">{comment.profiles?.name || 'Usuario'}</p>\r\n                                        <p className=\"text-sm text-zinc-700 dark:text-zinc-300 leading-tight\">{comment.content}</p>\r\n                                    </div>\r\n                                </div>\r\n                            ))\r\n                        ) : (\r\n                            <p className=\"text-center text-[10px] text-zinc-500 font-bold uppercase tracking-widest py-2\">S√© el primero en comentar ‚ú®</p>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Comment Input */}\r\n                    <div className=\"pt-2 flex gap-3 pb-4\">\r\n                        <input\r\n                            type=\"text\"\r\n                            placeholder=\"Escribe un comentario...\"\r\n                            value={commentInput}\r\n                            onChange={(e) => setCommentInput(e.target.value)}\r\n                            onKeyDown={(e) => e.key === 'Enter' && handleComment(post.id)}\r\n                            className=\"flex-1 bg-zinc-100 dark:bg-zinc-800 border-none rounded-xl px-4 py-3 text-sm text-zinc-900 dark:text-white outline-none ring-1 ring-black/5 dark:ring-white/10 focus:ring-blue-500/50 transition-all font-medium placeholder:text-zinc-500\"\r\n                        />\r\n                        <button\r\n                            onClick={() => handleComment(post.id)}\r\n                            disabled={!commentInput.trim()}\r\n                            className=\"bg-zinc-900 dark:bg-white text-white dark:text-black font-black text-[10px] uppercase tracking-widest px-6 rounded-xl hover:scale-105 active:scale-95 transition-all disabled:opacity-50\"\r\n                        >\r\n                            Enviar\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n});\r\n\r\n\r\nconst MOCK_POSTS = [];\r\n\r\nexport default function SocialFeed({ profileUserId = null }) {\r\n    const { isLoggedIn, session, userProfile, loading: authLoading } = useWishlist();\r\n    const [input, setInput] = useState('');\r\n    const [selectedImage, setSelectedImage] = useState(null);\r\n    const fileInputRef = useRef(null);\r\n    const [posts, setPosts] = useState([]);\r\n    const [isPosting, setIsPosting] = useState(false);\r\n    const [commentingOn, setCommentingOn] = useState(null);\r\n    const [commentInput, setCommentInput] = useState('');\r\n    const [comments, setComments] = useState({}); // { postId: [comments] }\r\n    const [loadingComments, setLoadingComments] = useState({});\r\n\r\n    // Pagination states\r\n    const [page, setPage] = useState(0);\r\n    const [hasMore, setHasMore] = useState(true);\r\n    const [isFetchingMore, setIsFetchingMore] = useState(false);\r\n    const pageSize = 10;\r\n    const loaderRef = useRef(null);\r\n\r\n    const fetchPosts = async (isInitial = true) => {\r\n        if (isInitial) {\r\n            setPage(0);\r\n            setHasMore(true);\r\n        } else {\r\n            if (!hasMore || isFetchingMore) return;\r\n            setIsFetchingMore(true);\r\n        }\r\n\r\n        const currentPage = isInitial ? 0 : page;\r\n        const start = currentPage * pageSize;\r\n        const end = start + pageSize - 1;\r\n\r\n        console.log(`üîÑ Fetching posts (page ${currentPage}, range ${start}-${end})...`);\r\n\r\n        try {\r\n            let query = supabase\r\n                .from('posts')\r\n                .select('*', { count: 'exact' })\r\n                .order('created_at', { ascending: false })\r\n                .range(start, end);\r\n\r\n            if (profileUserId) {\r\n                query = query.eq('user_id', profileUserId);\r\n            }\r\n\r\n            const { data: postsData, error: postsError, count } = await query;\r\n\r\n            if (postsError) throw postsError;\r\n\r\n            if (!postsData || postsData.length === 0) {\r\n                setHasMore(false);\r\n                if (isInitial) setPosts([]);\r\n                return;\r\n            }\r\n\r\n            // Fetch profiles for these posts\r\n            const userIds = [...new Set(postsData.map(p => p.user_id).filter(Boolean))];\r\n            let profilesMap = {};\r\n            if (userIds.length > 0) {\r\n                const { data: profilesData } = await supabase\r\n                    .from('profiles')\r\n                    .select('id, name, avatar_url')\r\n                    .in('id', userIds);\r\n                if (profilesData) {\r\n                    profilesMap = Object.fromEntries(profilesData.map(p => [p.id, p]));\r\n                }\r\n            }\r\n\r\n            // Fetch likes for these posts if logged in\r\n            let userLikedPostIds = new Set();\r\n            if (isLoggedIn && (userProfile?.id || session?.user?.id)) {\r\n                const currentId = userProfile?.id || session?.user?.id;\r\n                const { data: likesData } = await supabase\r\n                    .from('post_likes')\r\n                    .select('post_id')\r\n                    .eq('user_id', currentId)\r\n                    .in('post_id', postsData.map(p => p.id));\r\n                if (likesData) {\r\n                    userLikedPostIds = new Set(likesData.map(l => l.post_id));\r\n                }\r\n            }\r\n\r\n            const formatted = postsData.map(p => ({\r\n                id: p.id,\r\n                userId: p.user_id,\r\n                user: profilesMap[p.user_id]?.name || 'Comunidad JES',\r\n                avatar: profilesMap[p.user_id]?.avatar_url || null,\r\n                content: p.content,\r\n                image: p.media_url,\r\n                time: p.created_at ? new Date(p.created_at).toLocaleDateString() : 'Reciente',\r\n                likes: p.likes_count || 0,\r\n                comments: p.comments_count || 0,\r\n                isLiked: userLikedPostIds.has(p.id)\r\n            }));\r\n\r\n            if (isInitial) {\r\n                setPosts(formatted);\r\n            } else {\r\n                setPosts(prev => [...prev, ...formatted]);\r\n            }\r\n\r\n            setHasMore(postsData.length === pageSize);\r\n            if (!isInitial) setPage(prev => prev + 1);\r\n\r\n        } catch (err) {\r\n            console.error('‚ùå Error fetching posts:', err);\r\n        } finally {\r\n            setIsFetchingMore(false);\r\n        }\r\n    };\r\n\r\n    // Initial load and scroll observer\r\n    useEffect(() => {\r\n        fetchPosts(true);\r\n\r\n        const observer = new IntersectionObserver((entries) => {\r\n            if (entries[0].isIntersecting && hasMore && !isFetchingMore) {\r\n                fetchPosts(false);\r\n            }\r\n        }, { threshold: 1.0 });\r\n\r\n        if (loaderRef.current) observer.observe(loaderRef.current);\r\n\r\n        // Smarter Real-time: Just fetch the single newest post when inserted\r\n        const channel = supabase\r\n            .channel(`public:posts:${profileUserId || 'all'}`)\r\n            .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'posts' }, async (payload) => {\r\n                console.log('‚ú® New post received!');\r\n                const newPost = payload.new;\r\n\r\n                // Fetch profile for the new post\r\n                const { data: pData } = await supabase\r\n                    .from('profiles')\r\n                    .select('name, avatar_url')\r\n                    .eq('id', newPost.user_id)\r\n                    .single();\r\n\r\n                setPosts(prev => {\r\n                    // Evitar duplicados si el usuario es el autor y ya se agreg√≥ de forma optimista\r\n                    if (prev.some(p => p.id === newPost.id)) return prev;\r\n\r\n                    return [{\r\n                        id: newPost.id,\r\n                        userId: newPost.user_id,\r\n                        user: pData?.name || 'Comunidad JES',\r\n                        avatar: pData?.avatar_url || null,\r\n                        content: newPost.content,\r\n                        image: newPost.media_url,\r\n                        time: 'Ahora',\r\n                        likes: 0,\r\n                        comments: 0,\r\n                        isLiked: false\r\n                    }, ...prev];\r\n                });\r\n            })\r\n            .on('postgres_changes', { event: 'DELETE', schema: 'public', table: 'posts' }, (payload) => {\r\n                setPosts(prev => prev.filter(p => p.id !== payload.old.id));\r\n            })\r\n            .subscribe();\r\n\r\n        return () => {\r\n            observer.disconnect();\r\n            supabase.removeChannel(channel);\r\n        };\r\n    }, [isLoggedIn, profileUserId]);\r\n\r\n    const fetchComments = async (postId) => {\r\n        if (loadingComments[postId]) return;\r\n\r\n        setLoadingComments(prev => ({ ...prev, [postId]: true }));\r\n\r\n        try {\r\n            // Fetch comments without join first\r\n            const { data: commentsData, error } = await supabase\r\n                .from('post_comments')\r\n                .select('*')\r\n                .eq('post_id', postId)\r\n                .order('created_at', { ascending: true });\r\n\r\n            if (error) {\r\n                console.error('Error fetching comments:', error);\r\n                setComments(prev => ({ ...prev, [postId]: [] }));\r\n                return;\r\n            }\r\n\r\n            if (!commentsData || commentsData.length === 0) {\r\n                setComments(prev => ({ ...prev, [postId]: [] }));\r\n                return;\r\n            }\r\n\r\n            // Fetch profiles separately\r\n            const userIds = [...new Set(commentsData.map(c => c.user_id).filter(Boolean))];\r\n            let profilesMap = {};\r\n\r\n            if (userIds.length > 0) {\r\n                const { data: profilesData } = await supabase\r\n                    .from('profiles')\r\n                    .select('id, name, avatar_url')\r\n                    .in('id', userIds);\r\n\r\n                if (profilesData) {\r\n                    profilesMap = Object.fromEntries(profilesData.map(p => [p.id, p]));\r\n                }\r\n            }\r\n\r\n            // Format comments with profile info\r\n            const formatted = commentsData.map(c => ({\r\n                ...c,\r\n                profiles: profilesMap[c.user_id] || { name: 'Usuario', avatar_url: null }\r\n            }));\r\n\r\n            setComments(prev => ({ ...prev, [postId]: formatted }));\r\n        } finally {\r\n            setLoadingComments(prev => ({ ...prev, [postId]: false }));\r\n        }\r\n    };\r\n\r\n\r\n    useEffect(() => {\r\n        if (commentingOn) {\r\n            fetchComments(commentingOn);\r\n        }\r\n    }, [commentingOn]);\r\n\r\n    const handleImageSelect = (e) => {\r\n        const file = e.target.files[0];\r\n        if (file) {\r\n            setSelectedImage(file);\r\n        }\r\n    };\r\n\r\n    const handlePost = async () => {\r\n        if ((!input.trim() && !selectedImage) || isPosting) return;\r\n\r\n        // Get user ID - try multiple sources\r\n        const userId = userProfile?.id || session?.user?.id;\r\n\r\n        console.log('üîç Auth debug:', {\r\n            isLoggedIn,\r\n            userProfileId: userProfile?.id,\r\n            sessionUserId: session?.user?.id,\r\n            resolvedUserId: userId\r\n        });\r\n\r\n        // Validar que el usuario est√° logueado\r\n        if (!userId) {\r\n            alert('Debes iniciar sesi√≥n para publicar. Por favor recarga la p√°gina.');\r\n            return;\r\n        }\r\n\r\n        setIsPosting(true);\r\n\r\n        try {\r\n            let imageUrl = null;\r\n            if (selectedImage) {\r\n                try {\r\n                    console.log('üì∑ Uploading image...');\r\n                    const res = await uploadToCloudinary(selectedImage);\r\n                    imageUrl = res.secure_url;\r\n                    console.log('‚úÖ Image uploaded:', imageUrl);\r\n                } catch (uploadErr) {\r\n                    console.error('Error uploading image:', uploadErr);\r\n                    // Continue without image\r\n                }\r\n            }\r\n\r\n            const postData = {\r\n                user_id: userId,\r\n                content: input.trim(),\r\n                media_url: imageUrl,\r\n                created_at: new Date().toISOString()\r\n            };\r\n\r\n            console.log('üì§ Inserting post:', postData);\r\n\r\n            const { data, error } = await supabase\r\n                .from('posts')\r\n                .insert(postData)\r\n                .select()\r\n                .single();\r\n\r\n            if (error) {\r\n                console.error('‚ùå Supabase error:', error);\r\n                throw error;\r\n            }\r\n\r\n            console.log('‚úÖ Post creado:', data);\r\n\r\n            // Add to local state immediately\r\n            if (data) {\r\n                const newPost = {\r\n                    id: data.id,\r\n                    userId: userId,\r\n                    user: userProfile?.name || session?.user?.email?.split('@')[0] || 'Usuario',\r\n                    avatar: userProfile?.avatar_url || null,\r\n                    content: input.trim(),\r\n                    image: imageUrl,\r\n                    time: 'Ahora',\r\n                    likes: 0,\r\n                    comments: 0,\r\n                    isLiked: false\r\n                };\r\n                setPosts(prev => [newPost, ...prev]);\r\n            }\r\n\r\n            setInput('');\r\n            setSelectedImage(null);\r\n            if (fileInputRef.current) {\r\n                fileInputRef.current.value = '';\r\n            }\r\n        } catch (error) {\r\n            console.error('‚ùå Error posting:', error);\r\n            const msg = error.message || 'Error desconocido';\r\n            alert(`Error al publicar: ${msg}`);\r\n        } finally {\r\n            setIsPosting(false);\r\n        }\r\n    };\r\n\r\n\r\n\r\n    const toggleLike = async (postId) => {\r\n        if (!isLoggedIn) {\r\n            alert('¬°Oye! Inicia sesi√≥n para dar like.');\r\n            return;\r\n        }\r\n\r\n        const post = posts.find(p => p.id === postId);\r\n        const isLiked = post.isLiked;\r\n\r\n        // Optimistic UI\r\n        setPosts(prev => prev.map(p =>\r\n            p.id === postId ? { ...p, likes: isLiked ? p.likes - 1 : p.likes + 1, isLiked: !isLiked } : p\r\n        ));\r\n\r\n        try {\r\n            console.log(`üëç Toggling like for post ${postId}...`);\r\n            if (isLiked) {\r\n                const { error } = await supabase.from('post_likes').delete().eq('post_id', postId).eq('user_id', session.user.id);\r\n                if (error) throw error;\r\n            } else {\r\n                const { error } = await supabase.from('post_likes').insert({ post_id: postId, user_id: session.user.id });\r\n                if (error) throw error;\r\n            }\r\n            console.log('‚úÖ Like toggled successfully');\r\n        } catch (error) {\r\n            console.error('‚ùå Error toggling like:', error);\r\n            // Revert optimistic UI on error\r\n            setPosts(prev => prev.map(p =>\r\n                p.id === postId ? { ...p, likes: isLiked ? p.likes + 1 : p.likes - 1, isLiked: isLiked } : p\r\n            ));\r\n        }\r\n    };\r\n\r\n    const handleComment = async (postId) => {\r\n        if (!commentInput.trim() || !isLoggedIn) return;\r\n\r\n        const content = commentInput;\r\n        setCommentInput('');\r\n        setCommentingOn(null);\r\n\r\n        // Optimistic UI\r\n        setPosts(prev => prev.map(p =>\r\n            p.id === postId ? { ...p, comments: (p.comments || 0) + 1 } : p\r\n        ));\r\n\r\n        try {\r\n            const { error } = await supabase\r\n                .from('post_comments')\r\n                .insert({\r\n                    post_id: postId,\r\n                    user_id: session.user.id,\r\n                    content: content\r\n                });\r\n            if (error) throw error;\r\n\r\n            // Refrescar comentarios inmediatamente\r\n            fetchComments(postId);\r\n        } catch (error) {\r\n            console.error('Error commenting:', error);\r\n            alert('No pudimos enviar tu comentario.');\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"max-w-2xl mx-auto px-4 pb-32\">\r\n            {/* Header Social Visual Verification */}\r\n            <div className=\"flex flex-col gap-2 mb-10\">\r\n                <h2 className=\"text-4xl md:text-5xl font-black uppercase tracking-tighter italic\">\r\n                    Para <span className=\"text-blue-600\">Ti</span>\r\n                    <span className=\"ml-4 text-[10px] bg-blue-600 text-white px-3 py-1.5 rounded-full not-italic tracking-[0.2em] align-middle font-black shadow-lg shadow-blue-500/20\">LIVE</span>\r\n                </h2>\r\n                <p className=\"text-zinc-500 dark:text-zinc-400 text-[10px] font-black uppercase tracking-[0.4em]\">COMUNIDAD OFICIAL JES STORE</p>\r\n            </div>\r\n\r\n            {/* Create Post Header - Solo si es el feed general o mi propio perfil */}\r\n            {(!profileUserId || (profileUserId === session?.user?.id)) && (\r\n                (authLoading && !userProfile?.id) ? (\r\n                    <div className=\"bg-zinc-100 dark:bg-zinc-900 rounded-[32px] p-8 mb-8 text-center animate-pulse\">\r\n                        <div className=\"h-6 w-48 mx-auto bg-zinc-300 dark:bg-zinc-700 rounded-lg mb-4\" />\r\n                        <div className=\"h-4 w-64 mx-auto bg-zinc-200 dark:bg-zinc-800 rounded\" />\r\n                    </div>\r\n                ) : !isLoggedIn ? (\r\n                    <div className=\"bg-blue-600 rounded-[32px] p-8 mb-8 text-center shadow-2xl relative overflow-hidden group\">\r\n                        <div className=\"absolute inset-0 bg-white/5 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none\" />\r\n                        <h3 className=\"text-xl md:text-2xl font-black text-white uppercase tracking-tighter mb-4 italic\">√önete a la Comunidad</h3>\r\n                        <p className=\"text-blue-100 mb-6 font-medium text-sm md:text-base\">Inicia sesi√≥n para compartir tus fotos, rese√±as y vibras con la comunidad.</p>\r\n                        <Link href=\"/profile\" className=\"inline-block bg-white text-blue-600 px-10 py-4 rounded-full font-black uppercase tracking-widest text-[10px] hover:scale-105 active:scale-95 transition-all shadow-xl\">Iniciar Sesi√≥n</Link>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"bg-white dark:bg-zinc-900 rounded-[32px] p-6 mb-8 border border-black/10 dark:border-white/10 shadow-xl\">\r\n                        <div className=\"flex gap-4\">\r\n                            <div className=\"w-12 h-12 rounded-2xl bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center text-xl shadow-inner border border-black/5 dark:border-white/5 shrink-0 overflow-hidden relative\">\r\n                                {userProfile?.avatar_url ? (\r\n                                    <Image\r\n                                        src={userProfile.avatar_url}\r\n                                        fill\r\n                                        sizes=\"48px\"\r\n                                        className=\"object-cover\"\r\n                                        alt=\"\"\r\n                                    />\r\n                                ) : (\r\n                                    'üë§'\r\n                                )}\r\n                            </div>\r\n                            <div className=\"flex-1\">\r\n                                <textarea\r\n                                    placeholder=\"¬øQu√© quieres compartir con la comunidad?\"\r\n                                    value={input}\r\n                                    onChange={(e) => setInput(e.target.value)}\r\n                                    className=\"w-full bg-transparent border-none outline-none text-zinc-900 dark:text-white resize-none text-lg placeholder:text-zinc-500 dark:placeholder:text-zinc-700\"\r\n                                    rows=\"2\"\r\n                                />\r\n\r\n                                {selectedImage && (\r\n                                    <div className=\"mt-4 relative group\">\r\n                                        <img src={URL.createObjectURL(selectedImage)} className=\"w-24 h-24 object-cover rounded-2xl border-2 border-blue-500 shadow-lg\" alt=\"\" />\r\n                                        <button\r\n                                            onClick={() => setSelectedImage(null)}\r\n                                            className=\"absolute -top-2 -right-2 bg-red-500 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs shadow-lg hover:scale-110 transition-transform\"\r\n                                        >\r\n                                            ‚úï\r\n                                        </button>\r\n                                    </div>\r\n                                )}\r\n\r\n                                <div className=\"flex justify-between items-center mt-4 border-t border-black/5 dark:border-white/5 pt-4\">\r\n                                    <div className=\"flex gap-3 md:gap-5\">\r\n                                        <input\r\n                                            type=\"file\"\r\n                                            className=\"hidden\"\r\n                                            ref={fileInputRef}\r\n                                            accept=\"image/*\"\r\n                                            onChange={handleImageSelect}\r\n                                        />\r\n                                        <button\r\n                                            onClick={() => fileInputRef.current?.click()}\r\n                                            className=\"text-zinc-600 dark:text-zinc-400 hover:text-blue-500 transition-colors text-xl\"\r\n                                            title=\"Subir Imagen\"\r\n                                        >\r\n                                            üñºÔ∏è\r\n                                        </button>\r\n                                        <button className=\"text-zinc-600 dark:text-zinc-400 hover:text-blue-500 transition-colors text-xl\">üìπ</button>\r\n                                        <button className=\"text-zinc-600 dark:text-zinc-400 hover:text-blue-500 transition-colors text-xl\">üõí</button>\r\n                                    </div>\r\n                                    <button\r\n                                        onClick={handlePost}\r\n                                        disabled={(!input.trim() && !selectedImage) || isPosting}\r\n                                        className=\"bg-blue-600 disabled:opacity-50 text-white px-8 py-2.5 rounded-full font-black uppercase tracking-widest text-[10px] hover:scale-105 active:scale-95 transition-all shadow-lg shadow-blue-500/30\"\r\n                                    >\r\n                                        {isPosting ? 'Publicando...' : 'Publicar'}\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )\r\n            )}\r\n\r\n            {/* Posts Grid - Optimized with memoized components */}\r\n            <div className=\"space-y-6\">\r\n                {posts.length > 0 ? (\r\n                    <>\r\n                        {posts.map((post) => (\r\n                            <PostCard\r\n                                key={post.id}\r\n                                post={post}\r\n                                toggleLike={toggleLike}\r\n                                commentingOn={commentingOn}\r\n                                setCommentingOn={setCommentingOn}\r\n                                commentInput={commentInput}\r\n                                setCommentInput={setCommentInput}\r\n                                handleComment={handleComment}\r\n                                postComments={comments[post.id] || []}\r\n                                isLoadingComments={loadingComments[post.id] || false}\r\n                                fetchComments={fetchComments}\r\n                            />\r\n                        ))}\r\n\r\n                        {/* Elemento para detectar scroll infinito */}\r\n                        <div ref={loaderRef} className=\"py-12 flex flex-col items-center gap-4\">\r\n                            {hasMore ? (\r\n                                <>\r\n                                    <div className=\"w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full animate-spin\" />\r\n                                    <p className=\"text-[10px] font-black uppercase tracking-[0.3em] text-zinc-400 animate-pulse\">Cargando m√°s vibras...</p>\r\n                                </>\r\n                            ) : (\r\n                                <div className=\"h-px w-full bg-gradient-to-r from-transparent via-zinc-200 dark:via-zinc-800 to-transparent my-8 relative\">\r\n                                    <span className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white dark:bg-black px-4 text-[10px] font-black uppercase tracking-[0.4em] text-zinc-400\">Fin de la comunidad</span>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </>\r\n                ) : (\r\n                    <div className=\"py-20 text-center space-y-4 bg-zinc-50 dark:bg-zinc-900/30 rounded-[40px] border border-dashed border-black/5 dark:border-white/10\">\r\n                        <span className=\"text-5xl block mb-2 opacity-20\">‚ú®</span>\r\n                        <h3 className=\"text-xl font-black text-zinc-400 dark:text-zinc-600 uppercase tracking-tighter italic\">La comunidad espera...</h3>\r\n                        <p className=\"text-zinc-500 dark:text-zinc-500 font-bold uppercase text-[10px] tracking-[0.3em]\">S√© el primero en compartir algo</p>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n        </div>\r\n    );\r\n}\r\n","/**\r\n * Cloudinary Service for JES Store\r\n * Handles image uploads and URL generation.\r\n */\r\n\r\nconst CLOUD_NAME = process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME || process.env.VITE_CLOUDINARY_CLOUD_NAME || 'demo';\r\nconst UPLOAD_PRESET = process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET || process.env.VITE_CLOUDINARY_UPLOAD_PRESET || 'ml_default';\r\n\r\n/**\r\n * Generates a Cloudinary URL with transformations\r\n * @param {string} publicId - The public ID of the resource\r\n * @param {object} options - Transformation options (w, h, q, f, etc.)\r\n */\r\nexport const getCloudinaryUrl = (publicId, options = {}) => {\r\n    if (!publicId) return '';\r\n    if (publicId.startsWith('http')) return publicId; // Fallback if already a URL\r\n\r\n    const { width, height, crop = 'fill', quality = 'auto', format = 'auto' } = options;\r\n\r\n    let transformations = `q_${quality},f_${format}`;\r\n    if (width) transformations += `,w_${width}`;\r\n    if (height) transformations += `,h_${height}`;\r\n    if (crop) transformations += `,c_${crop}`;\r\n\r\n    return `https://res.cloudinary.com/${CLOUD_NAME}/image/upload/${transformations}/${publicId}`;\r\n};\r\n\r\n/**\r\n * Upload a file to Cloudinary using unsigned upload\r\n * @param {File} file - The file to upload\r\n * @returns {Promise<{public_id: string, secure_url: string, format: string, resource_type: string}>}\r\n */\r\nexport const uploadToCloudinary = async (file) => {\r\n    if (!CLOUD_NAME || CLOUD_NAME === 'demo') {\r\n        console.warn('Cloudinary not configured. Using local fallback.');\r\n        // Return a local URL for development\r\n        return {\r\n            public_id: `local_${Date.now()}`,\r\n            secure_url: URL.createObjectURL(file),\r\n            format: file.type.split('/')[1],\r\n            resource_type: file.type.startsWith('video') ? 'video' : 'image'\r\n        };\r\n    }\r\n\r\n    const formData = new FormData();\r\n    formData.append('file', file);\r\n    formData.append('upload_preset', UPLOAD_PRESET);\r\n    formData.append('folder', 'jes-community');\r\n\r\n    try {\r\n        const response = await fetch(\r\n            `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/auto/upload`,\r\n            {\r\n                method: 'POST',\r\n                body: formData\r\n            }\r\n        );\r\n\r\n        if (!response.ok) {\r\n            throw new Error(`Upload failed: ${response.statusText}`);\r\n        }\r\n\r\n        const data = await response.json();\r\n\r\n        return {\r\n            public_id: data.public_id,\r\n            secure_url: data.secure_url,\r\n            format: data.format,\r\n            resource_type: data.resource_type\r\n        };\r\n    } catch (error) {\r\n        console.error('Cloudinary upload error:', error);\r\n        // Fallback to local URL\r\n        return {\r\n            public_id: `fallback_${Date.now()}`,\r\n            secure_url: URL.createObjectURL(file),\r\n            format: file.type.split('/')[1],\r\n            resource_type: file.type.startsWith('video') ? 'video' : 'image'\r\n        };\r\n    }\r\n};\r\n\r\n/**\r\n * Delete an image from Cloudinary (requires server-side implementation)\r\n * Note: This is just a placeholder - actual deletion requires signed requests\r\n */\r\nexport const deleteFromCloudinary = async (publicId) => {\r\n    console.warn('Cloudinary deletion requires server-side implementation with signed requests.');\r\n    return { success: false, message: 'Server-side deletion not implemented' };\r\n};\r\n"],"names":[],"mappings":"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"}