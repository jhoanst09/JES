module.exports=[93254,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(19332);let e=async a=>{let b=new FormData;b.append("file",a),b.append("upload_preset","jes_community"),b.append("folder","jes-community");try{let a=await fetch("https://api.cloudinary.com/v1_1/duhsuc4yl/auto/upload",{method:"POST",body:b});if(!a.ok)throw Error(`Upload failed: ${a.statusText}`);let c=await a.json();return{public_id:c.public_id,secure_url:c.secure_url,format:c.format,resource_type:c.resource_type}}catch(b){return console.error("Cloudinary upload error:",b),{public_id:`fallback_${Date.now()}`,secure_url:URL.createObjectURL(a),format:a.type.split("/")[1],resource_type:a.type.startsWith("video")?"video":"image"}}};var f=a.i(21673),g=a.i(38246),h=a.i(71987);let i=(0,c.memo)(function({post:a,toggleLike:c,commentingOn:d,setCommentingOn:e,commentInput:f,setCommentInput:i,handleComment:j,comments:k,loadingComments:l}){return(0,b.jsx)("div",{className:"bg-white dark:bg-zinc-900 border border-black/10 dark:border-white/10 rounded-[40px] overflow-hidden shadow-xl transition-transform duration-300",children:(0,b.jsxs)("div",{className:"p-6",children:[(0,b.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,b.jsxs)(g.default,{href:a.userId?`/wishlist?user=${a.userId}`:"#",className:"flex gap-4 group/avatar",children:[(0,b.jsx)("div",{className:"w-12 h-12 rounded-full overflow-hidden border-2 border-transparent group-hover/avatar:border-blue-500 transition-all relative bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center text-xl",children:a.avatar?(0,b.jsx)(h.default,{src:a.avatar,fill:!0,sizes:"48px",className:"object-cover",alt:""}):"ðŸ‘¤"}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("h4",{className:"font-black text-zinc-900 dark:text-white lowercase group-hover/avatar:text-blue-500 transition-colors",children:["@",a.user]}),(0,b.jsx)("p",{className:"text-[10px] text-zinc-500 font-bold uppercase tracking-widest",children:a.time})]})]}),(0,b.jsx)("button",{className:"text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-colors",children:"â€¢â€¢â€¢"})]}),(0,b.jsx)("p",{className:"text-zinc-800 dark:text-zinc-200 text-lg mb-4 leading-relaxed font-medium",children:a.content}),a.image&&(0,b.jsx)("div",{className:"rounded-[32px] overflow-hidden mb-4 border border-black/5 dark:border-white/5 relative aspect-video",children:(0,b.jsx)(h.default,{src:a.image,fill:!0,sizes:"(max-width: 768px) 100vw, 640px",className:"object-cover",alt:""})}),(0,b.jsxs)("div",{className:"flex gap-8 border-t border-black/5 dark:border-white/5 pt-4",children:[(0,b.jsxs)("button",{onClick:()=>c(a.id),className:`flex items-center gap-2 transition-all active:scale-125 ${a.isLiked?"text-red-500":"text-zinc-600 dark:text-zinc-500 hover:text-red-500"}`,children:[a.isLiked?(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"22",height:"22",viewBox:"0 0 24 24",fill:"currentColor",className:"text-red-500",children:(0,b.jsx)("path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"})}):(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:(0,b.jsx)("path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"})}),(0,b.jsx)("span",{className:"text-xs font-black text-zinc-700 dark:text-zinc-300",children:a.likes})]}),(0,b.jsxs)("button",{onClick:()=>e(d===a.id?null:a.id),className:"flex items-center gap-2 text-zinc-600 dark:text-zinc-500 hover:text-blue-500 transition-all",children:[(0,b.jsx)("span",{className:"text-xl",children:"ðŸ’¬"}),(0,b.jsx)("span",{className:"text-xs font-black text-zinc-700 dark:text-zinc-300",children:a.comments})]}),(0,b.jsx)("button",{className:"flex items-center gap-2 text-zinc-500 hover:text-green-500 transition-colors ml-auto",children:(0,b.jsx)("span",{className:"text-xl",children:"ðŸ”—"})})]}),(0,b.jsxs)("div",{className:`overflow-hidden transition-all duration-300 ease-out border-t border-black/5 dark:border-white/5 mt-4 ${d===a.id?"max-h-[500px] opacity-100":"max-h-0 opacity-0 border-t-0"}`,children:[(0,b.jsx)("div",{className:"py-4 space-y-4",children:l[a.id]?(0,b.jsx)("p",{className:"text-center text-[10px] text-zinc-500 font-bold uppercase tracking-widest animate-pulse",children:"Cargando comentarios..."}):k[a.id]?.length>0?k[a.id].map(a=>(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-full overflow-hidden shrink-0 relative",children:(0,b.jsx)(h.default,{src:a.profiles?.avatar_url||"https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?auto=format&fit=crop&q=80&w=150",fill:!0,sizes:"32px",className:"object-cover",alt:""})}),(0,b.jsxs)("div",{className:"flex-1 bg-zinc-50 dark:bg-zinc-800/50 p-3 rounded-2xl border border-black/5 dark:border-white/5",children:[(0,b.jsx)("p",{className:"text-[10px] font-black text-zinc-900 dark:text-white capitalize mb-1",children:a.profiles?.name||"Usuario"}),(0,b.jsx)("p",{className:"text-sm text-zinc-700 dark:text-zinc-300 leading-tight",children:a.content})]})]},a.id)):(0,b.jsx)("p",{className:"text-center text-[10px] text-zinc-500 font-bold uppercase tracking-widest py-2",children:"SÃ© el primero en comentar âœ¨"})}),(0,b.jsxs)("div",{className:"pt-2 flex gap-3 pb-4",children:[(0,b.jsx)("input",{type:"text",placeholder:"Escribe un comentario...",value:f,onChange:a=>i(a.target.value),onKeyDown:b=>"Enter"===b.key&&j(a.id),className:"flex-1 bg-zinc-100 dark:bg-zinc-800 border-none rounded-xl px-4 py-3 text-sm text-zinc-900 dark:text-white outline-none ring-1 ring-black/5 dark:ring-white/10 focus:ring-blue-500/50 transition-all font-medium placeholder:text-zinc-500"}),(0,b.jsx)("button",{onClick:()=>j(a.id),disabled:!f.trim(),className:"bg-zinc-900 dark:bg-white text-white dark:text-black font-black text-[10px] uppercase tracking-widest px-6 rounded-xl hover:scale-105 active:scale-95 transition-all disabled:opacity-50",children:"Enviar"})]})]})]})})});function j({profileUserId:a=null}){let{isLoggedIn:j,session:k,userProfile:l,loading:m}=(0,f.useWishlist)(),[n,o]=(0,c.useState)(""),[p,q]=(0,c.useState)(null),r=(0,c.useRef)(null),[s,t]=(0,c.useState)([]),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(null),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)({}),[C,D]=(0,c.useState)({}),[E,F]=(0,c.useState)(0),[G,H]=(0,c.useState)(!0),[I,J]=(0,c.useState)(!1),K=(0,c.useRef)(null),L=async(b=!0)=>{if(b)F(0),H(!0);else{if(!G||I)return;J(!0)}let c=b?0:E,e=10*c,f=e+10-1;console.log(`ðŸ”„ Fetching posts (page ${c}, range ${e}-${f})...`);try{let c=d.supabase.from("posts").select("*",{count:"exact"}).order("created_at",{ascending:!1}).range(e,f);a&&(c=c.eq("user_id",a));let{data:g,error:h,count:i}=await c;if(h)throw h;if(!g||0===g.length){H(!1),b&&t([]);return}let m=[...new Set(g.map(a=>a.user_id).filter(Boolean))],n={};if(m.length>0){let{data:a}=await d.supabase.from("profiles").select("id, name, avatar_url").in("id",m);a&&(n=Object.fromEntries(a.map(a=>[a.id,a])))}let o=new Set;if(j&&(l?.id||k?.user?.id)){let a=l?.id||k?.user?.id,{data:b}=await d.supabase.from("post_likes").select("post_id").eq("user_id",a).in("post_id",g.map(a=>a.id));b&&(o=new Set(b.map(a=>a.post_id)))}let p=g.map(a=>({id:a.id,userId:a.user_id,user:n[a.user_id]?.name||"Comunidad JES",avatar:n[a.user_id]?.avatar_url||null,content:a.content,image:a.media_url,time:a.created_at?new Date(a.created_at).toLocaleDateString():"Reciente",likes:a.likes_count||0,comments:a.comments_count||0,isLiked:o.has(a.id)}));b?t(p):t(a=>[...a,...p]),H(10===g.length),b||F(a=>a+1)}catch(a){console.error("âŒ Error fetching posts:",a)}finally{J(!1)}};(0,c.useEffect)(()=>{L(!0);let b=new IntersectionObserver(a=>{a[0].isIntersecting&&G&&!I&&L(!1)},{threshold:1});K.current&&b.observe(K.current);let c=d.supabase.channel(`public:posts:${a||"all"}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"posts"},async a=>{console.log("âœ¨ New post received!");let b=a.new,{data:c}=await d.supabase.from("profiles").select("name, avatar_url").eq("id",b.user_id).single();t(a=>a.some(a=>a.id===b.id)?a:[{id:b.id,userId:b.user_id,user:c?.name||"Comunidad JES",avatar:c?.avatar_url||null,content:b.content,image:b.media_url,time:"Ahora",likes:0,comments:0,isLiked:!1},...a])}).on("postgres_changes",{event:"DELETE",schema:"public",table:"posts"},a=>{t(b=>b.filter(b=>b.id!==a.old.id))}).subscribe();return()=>{b.disconnect(),d.supabase.removeChannel(c)}},[j,a]);let M=async a=>{if(!C[a]){D(b=>({...b,[a]:!0}));try{let{data:b,error:c}=await d.supabase.from("post_comments").select("*").eq("post_id",a).order("created_at",{ascending:!0});if(c){console.error("Error fetching comments:",c),B(b=>({...b,[a]:[]}));return}if(!b||0===b.length)return void B(b=>({...b,[a]:[]}));let e=[...new Set(b.map(a=>a.user_id).filter(Boolean))],f={};if(e.length>0){let{data:a}=await d.supabase.from("profiles").select("id, name, avatar_url").in("id",e);a&&(f=Object.fromEntries(a.map(a=>[a.id,a])))}let g=b.map(a=>({...a,profiles:f[a.user_id]||{name:"Usuario",avatar_url:null}}));B(b=>({...b,[a]:g}))}finally{D(b=>({...b,[a]:!1}))}}};(0,c.useEffect)(()=>{w&&M(w)},[w]);let N=async()=>{if(!n.trim()&&!p||u)return;let a=l?.id||k?.user?.id;if(console.log("ðŸ” Auth debug:",{isLoggedIn:j,userProfileId:l?.id,sessionUserId:k?.user?.id,resolvedUserId:a}),!a)return void alert("Debes iniciar sesiÃ³n para publicar. Por favor recarga la pÃ¡gina.");v(!0);try{let b=null;if(p)try{console.log("ðŸ“· Uploading image..."),b=(await e(p)).secure_url,console.log("âœ… Image uploaded:",b)}catch(a){console.error("Error uploading image:",a)}let c={user_id:a,content:n.trim(),media_url:b,created_at:new Date().toISOString()};console.log("ðŸ“¤ Inserting post:",c);let{data:f,error:g}=await d.supabase.from("posts").insert(c).select().single();if(g)throw console.error("âŒ Supabase error:",g),g;if(console.log("âœ… Post creado:",f),f){let c={id:f.id,userId:a,user:l?.name||k?.user?.email?.split("@")[0]||"Usuario",avatar:l?.avatar_url||null,content:n.trim(),image:b,time:"Ahora",likes:0,comments:0,isLiked:!1};t(a=>[c,...a])}o(""),q(null),r.current&&(r.current.value="")}catch(b){console.error("âŒ Error posting:",b);let a=b.message||"Error desconocido";alert(`Error al publicar: ${a}`)}finally{v(!1)}},O=async a=>{if(!j)return void alert("Â¡Oye! Inicia sesiÃ³n para dar like.");let b=s.find(b=>b.id===a).isLiked;t(c=>c.map(c=>c.id===a?{...c,likes:b?c.likes-1:c.likes+1,isLiked:!b}:c));try{if(console.log(`ðŸ‘ Toggling like for post ${a}...`),b){let{error:b}=await d.supabase.from("post_likes").delete().eq("post_id",a).eq("user_id",k.user.id);if(b)throw b}else{let{error:b}=await d.supabase.from("post_likes").insert({post_id:a,user_id:k.user.id});if(b)throw b}console.log("âœ… Like toggled successfully")}catch(c){console.error("âŒ Error toggling like:",c),t(c=>c.map(c=>c.id===a?{...c,likes:b?c.likes+1:c.likes-1,isLiked:b}:c))}},P=async a=>{if(y.trim()&&j){z(""),x(null),t(b=>b.map(b=>b.id===a?{...b,comments:(b.comments||0)+1}:b));try{let{error:b}=await d.supabase.from("post_comments").insert({post_id:a,user_id:k.user.id,content:y});if(b)throw b;M(a)}catch(a){console.error("Error commenting:",a),alert("No pudimos enviar tu comentario.")}}};return(0,b.jsxs)("div",{className:"max-w-2xl mx-auto px-4 pb-32",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-2 mb-10",children:[(0,b.jsxs)("h2",{className:"text-4xl md:text-5xl font-black uppercase tracking-tighter italic",children:["Para ",(0,b.jsx)("span",{className:"text-blue-600",children:"Ti"}),(0,b.jsx)("span",{className:"ml-4 text-[10px] bg-blue-600 text-white px-3 py-1.5 rounded-full not-italic tracking-[0.2em] align-middle font-black shadow-lg shadow-blue-500/20",children:"LIVE"})]}),(0,b.jsx)("p",{className:"text-zinc-500 dark:text-zinc-400 text-[10px] font-black uppercase tracking-[0.4em]",children:"COMUNIDAD OFICIAL JES STORE"})]}),(!a||a===k?.user?.id)&&(m?(0,b.jsxs)("div",{className:"bg-zinc-100 dark:bg-zinc-900 rounded-[32px] p-8 mb-8 text-center animate-pulse",children:[(0,b.jsx)("div",{className:"h-6 w-48 mx-auto bg-zinc-300 dark:bg-zinc-700 rounded-lg mb-4"}),(0,b.jsx)("div",{className:"h-4 w-64 mx-auto bg-zinc-200 dark:bg-zinc-800 rounded"})]}):j?(0,b.jsx)("div",{className:"bg-white dark:bg-zinc-900 rounded-[32px] p-6 mb-8 border border-black/10 dark:border-white/10 shadow-xl",children:(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsx)("div",{className:"w-12 h-12 rounded-2xl bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center text-xl shadow-inner border border-black/5 dark:border-white/5 shrink-0 overflow-hidden relative",children:l?.avatar_url?(0,b.jsx)(h.default,{src:l.avatar_url,fill:!0,sizes:"48px",className:"object-cover",alt:""}):"ðŸ‘¤"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("textarea",{placeholder:"Â¿QuÃ© quieres compartir con la comunidad?",value:n,onChange:a=>o(a.target.value),className:"w-full bg-transparent border-none outline-none text-zinc-900 dark:text-white resize-none text-lg placeholder:text-zinc-500 dark:placeholder:text-zinc-700",rows:"2"}),p&&(0,b.jsxs)("div",{className:"mt-4 relative group",children:[(0,b.jsx)("img",{src:URL.createObjectURL(p),className:"w-24 h-24 object-cover rounded-2xl border-2 border-blue-500 shadow-lg",alt:""}),(0,b.jsx)("button",{onClick:()=>q(null),className:"absolute -top-2 -right-2 bg-red-500 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs shadow-lg hover:scale-110 transition-transform",children:"âœ•"})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center mt-4 border-t border-black/5 dark:border-white/5 pt-4",children:[(0,b.jsxs)("div",{className:"flex gap-3 md:gap-5",children:[(0,b.jsx)("input",{type:"file",className:"hidden",ref:r,accept:"image/*",onChange:a=>{let b=a.target.files[0];b&&q(b)}}),(0,b.jsx)("button",{onClick:()=>r.current?.click(),className:"text-zinc-600 dark:text-zinc-400 hover:text-blue-500 transition-colors text-xl",title:"Subir Imagen",children:"ðŸ–¼ï¸"}),(0,b.jsx)("button",{className:"text-zinc-600 dark:text-zinc-400 hover:text-blue-500 transition-colors text-xl",children:"ðŸ“¹"}),(0,b.jsx)("button",{className:"text-zinc-600 dark:text-zinc-400 hover:text-blue-500 transition-colors text-xl",children:"ðŸ›’"})]}),(0,b.jsx)("button",{onClick:N,disabled:!n.trim()&&!p||u,className:"bg-blue-600 disabled:opacity-50 text-white px-8 py-2.5 rounded-full font-black uppercase tracking-widest text-[10px] hover:scale-105 active:scale-95 transition-all shadow-lg shadow-blue-500/30",children:u?"Publicando...":"Publicar"})]})]})]})}):(0,b.jsxs)("div",{className:"bg-blue-600 rounded-[32px] p-8 mb-8 text-center shadow-2xl relative overflow-hidden group",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-white/5 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"}),(0,b.jsx)("h3",{className:"text-xl md:text-2xl font-black text-white uppercase tracking-tighter mb-4 italic",children:"Ãšnete a la Comunidad"}),(0,b.jsx)("p",{className:"text-blue-100 mb-6 font-medium text-sm md:text-base",children:"Inicia sesiÃ³n para compartir tus fotos, reseÃ±as y vibras con la comunidad."}),(0,b.jsx)(g.default,{href:"/profile",className:"inline-block bg-white text-blue-600 px-10 py-4 rounded-full font-black uppercase tracking-widest text-[10px] hover:scale-105 active:scale-95 transition-all shadow-xl",children:"Iniciar SesiÃ³n"})]})),(0,b.jsx)("div",{className:"space-y-6",children:s.length>0?(0,b.jsxs)(b.Fragment,{children:[s.map(a=>(0,b.jsx)(i,{post:a,toggleLike:O,commentingOn:w,setCommentingOn:x,commentInput:y,setCommentInput:z,handleComment:P,comments:A[a.id]||[],isLoadingComments:C[a.id],fetchComments:M},a.id)),(0,b.jsx)("div",{ref:K,className:"py-12 flex flex-col items-center gap-4",children:G?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),(0,b.jsx)("p",{className:"text-[10px] font-black uppercase tracking-[0.3em] text-zinc-400 animate-pulse",children:"Cargando mÃ¡s vibras..."})]}):(0,b.jsx)("div",{className:"h-px w-full bg-gradient-to-r from-transparent via-zinc-200 dark:via-zinc-800 to-transparent my-8 relative",children:(0,b.jsx)("span",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white dark:bg-black px-4 text-[10px] font-black uppercase tracking-[0.4em] text-zinc-400",children:"Fin de la comunidad"})})})]}):(0,b.jsxs)("div",{className:"py-20 text-center space-y-4 bg-zinc-50 dark:bg-zinc-900/30 rounded-[40px] border border-dashed border-black/5 dark:border-white/10",children:[(0,b.jsx)("span",{className:"text-5xl block mb-2 opacity-20",children:"âœ¨"}),(0,b.jsx)("h3",{className:"text-xl font-black text-zinc-400 dark:text-zinc-600 uppercase tracking-tighter italic",children:"La comunidad espera..."}),(0,b.jsx)("p",{className:"text-zinc-500 dark:text-zinc-500 font-bold uppercase text-[10px] tracking-[0.3em]",children:"SÃ© el primero en compartir algo"})]})})]})}a.s(["default",()=>j],93254)}];

//# sourceMappingURL=src_components_SocialFeed_jsx_bfc485f6._.js.map